<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SciText Digitizer Stylesheet</title>
    
    <!-- This file now contains all CSS and HTML structure -->
    <!-- 
    It should include only robustly implemented HTML and css that is unlikely to require modification in the context of this project. The details may be overridden by main.html during development. The goal is to keep main.html smaller.
    This file lives at https://lsparrish.github.io/sciconvert/src/template.html
    Changes made here will need to be pushed to github before they are available.
    Note: Use the full url.
    -->
    
    <style>
      /* --- Base & Reset --- */
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #111827;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        color: #1f2937;
        font-size: 14px;
        line-height: 1.5;
      }
      /* --- Scrollbar --- */
      ::-webkit-scrollbar { width: 10px; height: 10px; }
      ::-webkit-scrollbar-track { background: #1f2937; }
      ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 5px; border: 2px solid #1f2937; }
      ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

      /* --- Layout Classes --- */
      .flex-container { display: flex; }
      .flex-col { flex-direction: column; }
      .flex-1 { flex: 1; }
      .shrink-0 { flex-shrink: 0; }
      .relative { position: relative; }
      .absolute { position: absolute; }
      .inset-0 { top: 0; left: 0; right: 0; bottom: 0; }
      .z-10 { z-index: 10; }
      .z-20 { z-index: 20; }
      .z-30 { z-index: 30; }
      .z-50 { z-index: 50; }
      .hidden { display: none !important; }
      .p-6 { padding: 1.5rem; }
      .p-12 { padding: 3rem; }
      .p-1-5 { padding: 0.375rem 0.75rem; }
      .pt-2 { padding-top: 0.5rem; }
      .pb-1 { padding-bottom: 0.25rem; }
      .px-4 { padding-left: 1rem; padding-right: 1rem; }
      .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
      .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
      .py-1-5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
      .gap-1 { gap: 0.25rem; }
      .gap-2 { gap: 0.5rem; }
      .gap-3 { gap: 0.75rem; }
      .gap-4 { gap: 1rem; }
      .gap-6 { gap: 1.5rem; }
      .mb-1 { margin-bottom: 0.25rem; }
      .mb-2 { margin-bottom: 0.5rem; }
      .mb-4 { margin-bottom: 1rem; }
      .mb-6 { margin-bottom: 1.5rem; }
      .mt-4 { margin-top: 1rem; }
      .ml-2 { margin-left: 0.5rem; }
      .mx-1 { margin-left: 0.25rem; margin-right: 0.25rem; }
      .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
      .w-12 { width: 3rem; }
      .w-80 { width: 20rem; }
      .min-w-320 { min-width: 320px; }
      .h-full { height: 100%; }
      .h-80 { height: 20rem; }
      .w-px { width: 1px; }

      /* --- Typography & Colors --- */
      .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
      .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
      .text-xs { font-size: 0.75rem; line-height: 1rem; }
      .text-2xl { font-size: 1.5rem; line-height: 2rem; }
      .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
      .font-bold { font-weight: 700; }
      .font-semibold { font-weight: 600; }
      .font-medium { font-weight: 500; }
      .font-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      .uppercase { text-transform: uppercase; }
      .tracking-wider { letter-spacing: 0.05em; }
      .tracking-wide { letter-spacing: 0.025em; }
      .text-white { color: white; }
      .text-gray-100 { color: #f3f4f6; }
      .text-gray-200 { color: #e5e7eb; }
      .text-gray-300 { color: #d1d5db; }
      .text-gray-400 { color: #9ca3af; }
      .text-gray-500 { color: #6b7280; }
      .text-gray-600 { color: #4b5563; }
      .text-gray-700 { color: #374151; }
      .text-gray-800 { color: #1f2937; }
      .text-blue-400 { color: #60a5fa; }
      .text-blue-600 { color: #2563eb; }
      .text-blue-700 { color: #1d4ed8; }
      .text-red-500 { color: #ef4444; }
      .text-red-700 { color: #b91c1c; }
      .text-green-700 { color: #047857; }
      .text-yellow-500 { color: #f59e0b; }
      .text-purple-400 { color: #c084fc; }
      .text-amber-600 { color: #d97706; }
      .text-teal-600 { color: #0d9488; }
      .text-indigo-700 { color: #4338ca; }
      .text-amber-500 { color: #f59e0b; }
      .text-blue-500 { color: #3b82f6; }
      .text-red-400 { color: #f87171; }
      .text-green-400 { color: #4ade80; }

      /* --- Backgrounds --- */
      .bg-white { background-color: white; }
      .bg-gray-50 { background-color: #f9fafb; }
      .bg-gray-100 { background-color: #f3f4f6; }
      .bg-gray-200 { background-color: #e5e7eb; }
      .bg-gray-600 { background-color: #4b5563; }
      .bg-gray-700 { background-color: #374151; }
      .bg-gray-800 { background-color: #1f2937; }
      .bg-gray-900 { background-color: #111827; }
      .bg-blue-50 { background-color: #eff6ff; }
      .bg-blue-100 { background-color: #dbeafe; }
      .bg-blue-600 { background-color: #2563eb; }
      .bg-purple-600 { background-color: #9333ea; }
      .bg-amber-600 { background-color: #d97706; }
      .bg-gray-500\/20 { background-color: rgba(99, 102, 241, 0.2); }
      .bg-black { background-color: black; }
      .bg-opacity-70 { background-color: rgba(17, 24, 39, 0.7); }
      .bg-opacity-95 { background-color: rgba(31, 41, 55, 0.95); }
      .bg-\[\#1a1a1a\] { background-color: #1a1a1a; }
      
      /* --- Borders & Shadows --- */
      .border { border-width: 1px; border-style: solid; }
      .border-b { border-bottom-width: 1px; border-style: solid; }
      .border-t { border-top-width: 1px; border-style: solid; }
      .border-r { border-right-width: 1px; border-style: solid; }
      .border-gray-200 { border-color: #e5e7eb; }
      .border-gray-300 { border-color: #d1d5db; }
      .border-gray-600 { border-color: #4b5563; }
      .border-gray-700 { border-color: #374151; }
      .border-gray-800 { border-color: #1f2937; }
      .border-gray-900 { border-color: #111827; }
      .border-blue-200 { border-color: #bfdbfe; }
      .border-blue-300 { border-color: #93c5fd; }
      .border-green-300 { border-color: #6ee7b7; }
      .border-indigo-200 { border-color: #c7d2fe; }
      .rounded { border-radius: 0.25rem; }
      .rounded-sm { border-radius: 0.125rem; }
      .rounded-md { border-radius: 0.375rem; }
      .rounded-lg { border-radius: 0.5rem; }
      .rounded-2xl { border-radius: 1rem; }
      .rounded-full { border-radius: 9999px; }
      .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
      .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
      .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
      .shadow-inner { box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); }
      .ring-1 { box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05); }
      .ring-black\/50 { box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5); }
      .ring-blue-400\/20 { box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.2); }
      
      /* --- Components --- */
      .app-header {
        background-color: #1f2937;
        padding: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid #111827;
      }
      .header-group { display: flex; align-items: center; gap: 1rem; }
      .header-h1 { font-size: 1.25rem; font-weight: 700; letter-spacing: 0.05em; color: #f3f4f6; margin-right: 1rem; }
      .header-h1 span { color: #60a5fa; }

      .btn {
        padding: 0.375rem 0.75rem;
        border-radius: 0.25rem;
        font-weight: 600;
        transition: all 0.15s ease-in-out;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        border: 1px solid transparent;
      }
      .btn-primary { background-color: #2563eb; color: white; border-color: #60a5fa33; }
      .btn-primary:hover { background-color: #3b82f6; }
      .btn-secondary { background-color: #374151; color: #e5e7eb; border-color: #4b5563; }
      .btn-secondary:hover { background-color: #4b5563; }
      
      .input-style {
        width: 100%;
        background-color: white;
        border: 1px solid #d1d5db;
        border-radius: 0.25rem;
        padding: 0.375rem;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        color: #374151;
        outline: none;
      }
      .input-style:focus { border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }

      /* Sidebar Specific Styles */
      .sidebar-panel {
        width: 20rem;
        min-width: 320px;
        height: 100%;
        display: flex;
        flex-direction: column;
        border-right: 1px solid #e5e7eb;
        background-color: white;
        z-index: 10;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      
      .action-bar-btn {
        padding: 0.25rem 0.75rem;
        border-radius: 0.25rem;
        font-weight: 700;
        font-size: 0.75rem;
        color: white;
        transition: background-color 0.15s;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        border: 1px solid transparent;
      }
      .action-bar-btn:hover { opacity: 0.9; }

      /* Animation and Utility */
      .animate-spin { animation: spin 1s linear infinite; }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      .backdrop-blur-sm { backdrop-filter: blur(4px); }
      .select-none { user-select: none; }
      .cursor-pointer { cursor: pointer; }
      .transition { transition: all 0.15s ease-in-out; }
      .disabled { opacity: 0.5; pointer-events: none; }
      
      /* --- SVG Overlay Styles (Critical) --- */
      #canvas-wrapper {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        transition: width 0.15s ease-out;
        background-color: white;
        position: relative;
        transform-origin: top;
        border: 1px solid rgba(17, 24, 39, 0.05);
      }
      
      .grid-overlay {
          background-size: 50px 50px;
          background-image:
            linear-gradient(to right, rgba(0, 0, 0, 0.05) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
          pointer-events: none;
      }

      .region-highlight {
          stroke: #f97316; stroke-width: 2; fill: rgba(249, 115, 22, 0.05);
          opacity: 0; transition: opacity 0.15s; pointer-events: all;
      }
      .region-highlight:hover { opacity: 1.0; cursor: pointer; }

      .region-selected {
          stroke: #3b82f6; stroke-width: 2; fill: rgba(59, 130, 246, 0.2);
          pointer-events: all; cursor: move;
      }
      
      .region-draft {
          fill: rgba(59, 130, 246, 0.1); stroke: #3b82f6; stroke-width: 2;
          stroke-dasharray: 8, 4; animation: dash 30s linear infinite;
          pointer-events: none;
      }
      
      .split-overlay {
          stroke: #6366f1; stroke-width: 1; fill: rgba(99, 102, 241, 0.1); stroke-dasharray: 4, 2;
          pointer-events: all; cursor: pointer;
      }
      .split-overlay:hover { stroke-width: 2; fill: rgba(99, 102, 241, 0.3); }
      .split-overlay.selected { stroke: #ef4444; stroke-width: 2; fill: rgba(239, 68, 68, 0.4); }
      
      @keyframes dash { to { stroke-dashoffset: -1000; } }

      #selection-box {
        border: 2px dashed #3b82f6; background-color: rgba(59, 130, 246, 0.1);
        position: absolute; pointer-events: none; display: none; z-index: 50;
      }

      .selection-frame {
          position: absolute; border: 1px solid #3b82f6;
          box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.3);
          background-color: rgba(59, 130, 246, 0.05);
          cursor: move; z-index: 40; box-sizing: border-box;
      }

      .resize-handle {
          position: absolute; width: 10px; height: 10px;
          background-color: white; border: 2px solid #3b82f6;
          z-index: 50; border-radius: 2px; transition: transform 0.1s;
      }
      .resize-handle:hover { transform: scale(1.2); background-color: #eff6ff; }
      
      .handle-nw { top: -6px; left: -6px; cursor: nw-resize; }
      .handle-n  { top: -6px; left: 50%; margin-left: -5px; cursor: n-resize; }
      .handle-ne { top: -6px; right: -6px; cursor: ne-resize; }
      .handle-e  { top: 50%; right: -6px; margin-top: -5px; cursor: e-resize; }
      .handle-se { bottom: -6px; right: -6px; cursor: se-resize; }
      .handle-s  { bottom: -6px; left: 50%; margin-left: -5px; cursor: s-resize; }
      .handle-sw { bottom: -6px; left: -6px; cursor: sw-resize; }
      .handle-w  { top: 50%; left: -6px; margin-top: -5px; cursor: w-resize; }

      #new-selection-action-bar {
        position: fixed; z-index: 100; display: none; animation: fadeIn 0.1s ease-out;
        background-color: rgba(31, 41, 55, 0.95);
        color: white;
        border-radius: 0.5rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        padding: 0.375rem;
        gap: 0.5rem;
        border: 1px solid #4b5563;
        backdrop-filter: blur(4px);
      }

      /* Input/Textarea Styles */
      .editor-textarea { 
        font-family: monospace; 
        line-height: 1.5; 
        resize: none; 
        font-size: 11px; 
        width: 100%;
        height: 100%;
        padding: 0.5rem;
        border: none;
        outline: none;
        background-color: #f9fafb;
        color: #374151;
      }
      .editor-textarea:focus { 
        outline: none; 
        background-color: #fff; 
        box-shadow: inset 0 0 0 2px #bfdbfe; 
      }
      input[type="number"] {
        padding: 0.375rem;
        border: 1px solid #d1d5db;
        border-radius: 0.25rem;
        font-family: monospace;
        color: #374151;
        outline: none;
      }
      input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="flex-col">
    
    <!-- HEADER -->
    <header class="app-header z-30 shrink-0 border-b border-gray-900">
      <div class="header-group">
        <h1 class="header-h1">SciText <span>Digitizer</span></h1>
        
        <!-- File Upload -->
        <div class="relative group">
          <input type="file" id="pdf-upload" accept="application/pdf, image/*" class="hidden" />
          <label for="pdf-upload" class="btn btn-primary shadow-sm ring-1 ring-blue-400/20">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
            Load
          </label>
        </div>
        
        <div class="w-px h-6 bg-gray-600 mx-2"></div>

        <!-- Zoom Controls -->
        <div id="pdf-zoom-controls" class="flex-container items-center bg-gray-700 rounded-md p-0.5 shadow-inner border border-gray-600">
          <button id="zoom-out" class="text-gray-300 p-1 px-2 rounded-sm font-bold transition">-</button>
          <span id="zoom-level" class="text-xs font-mono w-14 text-center text-gray-200 select-none">100%</span>
          <button id="zoom-in" class="text-gray-300 p-1 px-2 rounded-sm font-bold transition">+</button>
        </div>

        <!-- History Controls -->
        <div class="flex-container items-center gap-1 ml-2">
            <button id="btn-undo" class="text-gray-400 p-1 rounded disabled transition" title="Undo"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg></button>
            <button id="btn-redo" class="text-gray-400 p-1 rounded disabled transition" title="Redo"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3" /></svg></button>
        </div>
      </div>
      
      <div class="header-group">
          <span id="ai-status" class="hidden text-blue-400 text-xs font-mono animate-pulse flex-container items-center gap-2">Processing...</span>
          <button id="fullscreen-toggle" class="btn btn-secondary text-xs font-semibold border border-gray-600">Full Screen</button>
      </div>
    </header>

    <main class="flex-1 flex-col overflow-hidden relative bg-white">
      <!-- Tab Bar -->
      <div class="flex-container bg-gray-50 border-b border-gray-200 shadow-sm shrink-0 z-20">
        <button id="tab-overlay" class="tab-button active">Compositor</button>
        <button id="tab-debug" class="tab-button">Debug View</button>
      </div>

      <!-- Empty State & Loader -->
      <div id="empty-state" class="absolute inset-0 flex-container flex-col items-center justify-center bg-gray-50 z-50 text-gray-500">
        <div class="bg-white p-6 rounded-2xl shadow-xl text-center border border-gray-200">
            <h2 class="text-xl font-bold mb-2 text-gray-700">No Document Loaded</h2>
            <p class="text-sm text-gray-500">Upload a PDF or Image to begin.</p>
        </div>
      </div>
      
      <div id="pdf-loader" class="absolute inset-0 bg-gray-900 bg-opacity-70 flex-container flex-col items-center justify-center hidden z-50 backdrop-blur-sm">
          <div class="w-12 h-12 border-4 border-t-blue-500 border-gray-600 rounded-full animate-spin mb-4"></div>
          <span class="text-white font-bold tracking-wide text-lg">Loading...</span>
      </div>

      <!-- Main Workspace (Compositor/Overlay Tab) -->
      <div id="workspace-container" class="flex-1 flex-container overflow-hidden relative hidden">
          
          <!-- Left Sidebar (Properties & Layers) -->
          <div class="sidebar-panel w-80 min-w-320 border-r border-gray-200 bg-white z-10 shadow-xl">
              <!-- Properties Header -->
              <div class="bg-gray-100 px-4 py-3 text-xs font-bold text-gray-600 border-b border-gray-200 flex-container flex-col gap-2 shrink-0">
                  <div class="flex-container justify-between items-center">
                      <span class="tracking-wide uppercase">Properties</span>
                      <div class="flex-container items-center gap-2">
                          <div class="flex-container bg-gray-200 rounded p-0.5 border border-gray-300">
                              <button id="mode-area" class="px-2 py-0.5 rounded text-[10px] font-bold transition bg-white shadow-sm text-blue-600">Area</button>
                              <button id="mode-content" class="px-2 py-0.5 rounded text-[10px] font-bold transition text-gray-500">Content</button>
                          </div>
                          <span id="region-count" class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-[10px] font-bold">0</span>
                      </div>
                  </div>
                  <div class="flex-container justify-between items-center border-t border-gray-200 pt-2 mt-1">
                      <span class="text-[10px] text-gray-400 font-normal">Geometry Tools:</span>
                      <div class="flex-container gap-2">
                           <button id="btn-fit-area" class="btn btn-secondary text-[10px] font-semibold">Fit Area</button>
                           <button id="btn-fit-content" class="btn btn-secondary text-[10px] font-semibold">Fill Content</button>
                      </div>
                  </div>
              </div>

              <!-- Position/Size/Offset Inputs -->
              <div class="p-4 bg-gray-50 border-b border-gray-200 grid grid-cols-2 gap-3 text-xs select-none relative shrink-0">
                  <div id="mode-label" class="absolute top-1 right-2 text-[9px] font-bold text-blue-400 uppercase tracking-widest pointer-events-none">Area Mode</div>
                  <div class="col-span-2 grid grid-cols-2 gap-3">
                      <div><label id="lbl-x" class="block text-gray-400 font-bold mb-1 uppercase text-[10px]">Pos X</label><input type="number" id="prop-x" class="input-style" disabled></div>
                      <div><label id="lbl-y" class="block text-gray-400 font-bold mb-1 uppercase text-[10px]">Pos Y</label><input type="number" id="prop-y" class="input-style" disabled></div>
                  </div>
                  <div class="col-span-2 grid grid-cols-2 gap-3">
                      <div><label id="lbl-w" class="block text-gray-400 font-bold mb-1 uppercase text-[10px]">Width</label><input type="number" id="prop-w" class="input-style" disabled></div>
                      <div><label id="lbl-h" class="block text-gray-400 font-bold mb-1 uppercase text-[10px]">Height</label><input type="number" id="prop-h" class="input-style" disabled></div>
                  </div>
              </div>
              
              <!-- Layer List Header -->
              <div class="px-4 py-2 text-xs font-bold text-gray-500 border-b bg-gray-100 flex-container justify-between items-center shadow-inner shrink-0">
                  <span class="tracking-wide uppercase">Region Layers</span>
                  <button id="btn-add-layer" class="text-[10px] text-blue-600 font-bold px-2 py-0.5 bg-blue-50 rounded border border-blue-200 transition">+ Add</button>
              </div>
              <!-- Layer List Container -->
              <div id="layer-list" class="flex-1 overflow-y-auto p-2 space-y-2 bg-gray-100 border-t border-gray-200">
                  <div class="text-center text-gray-400 text-[10px] mt-4">Select a region to view layers</div>
              </div>
              
              <!-- Footer Actions -->
              <div class="p-3 border-t border-gray-200 bg-gray-50 flex-container flex-wrap gap-2 items-center justify-between shrink-0">
                  <div id="debug-actions-left" class="flex-container gap-2">
                    <button id="btn-export" class="btn btn-secondary text-green-700 border border-green-300 shadow-sm transition font-bold">Compose SVG</button>
                    <button id="btn-clear-all" class="text-red-500 px-2 py-1.5 rounded text-xs font-medium transition">Reset</button>
                  </div>
                  <div id="context-actions" class="flex-container gap-2 transition disabled">
                       <button id="btn-digitize" class="action-bar-btn bg-purple-600">AI Text</button>
                       <button id="btn-split" class="action-bar-btn bg-indigo-700 text-indigo-700 bg-indigo-50 border border-indigo-200">Split</button>
                       <button id="btn-group" class="action-bar-btn bg-teal-600">Group</button>
                       <button id="btn-optimize" class="action-bar-btn bg-indigo-700 text-indigo-700 bg-indigo-50 border border-indigo-200">Opt</button>
                       <button id="btn-regen" class="action-bar-btn bg-blue-600">Regen</button>
                       <button id="btn-delete" class="btn btn-secondary text-gray-700 border border-gray-300 shadow-sm transition font-semibold">Del</button>
                  </div>
              </div>
          </div>

          <!-- Right Canvas Viewport -->
          <div class="flex-1 h-full flex-container flex-col bg-gray-200 relative overflow-hidden">
              <!-- View Toggles -->
              <div class="bg-white px-4 py-2 flex-container justify-center items-center gap-6 text-xs font-bold text-gray-600 border-b border-gray-300 shrink-0 z-20">
                   <label class="flex-container items-center gap-2 cursor-pointer transition"><input type="checkbox" id="chk-source" checked class="rounded text-blue-600"><span class="text-blue-600">Source</span></label>
                   <div class="w-px h-4 bg-gray-300"></div>
                   <label class="flex-container items-center gap-2 cursor-pointer transition"><input type="checkbox" id="chk-svg" checked class="rounded text-blue-600"><span class="text-blue-600">SVG Overlay</span></label>
                   <div class="w-px h-4 bg-gray-300"></div>
                   <label class="flex-container items-center gap-2 cursor-pointer transition"><input type="checkbox" id="chk-grid" class="rounded text-blue-600"><span class="text-blue-600">Grid</span></label>
              </div>
              
              <!-- Canvas Scroller and Wrapper -->
              <div id="canvas-scroller" class="flex-1 overflow-auto flex-container justify-center p-12 relative cursor-default bg-gray-200">
                  <div id="canvas-wrapper" class="relative bg-white origin-top transition">
                      <!-- Layers rendered by JS: PDF Image, Grid, SVG Output, Interaction Area -->
                      <div id="pdf-layer" class="transition"></div> 
                      <div id="grid-layer" class="absolute inset-0 grid-overlay hidden opacity-50 pointer-events-none z-0"></div>
                      <div id="svg-layer" class="absolute inset-0 z-10 transition pointer-events-none"></div> 
                      <div id="interaction-layer" class="absolute inset-0 z-20"></div>
                      <div id="selection-box"></div>
                  </div>
              </div>
          </div>
      </div>
      
      <!-- Debug View Container -->
      <div id="debug-container" class="flex-1 hidden flex-col bg-gray-900 p-6 overflow-auto text-white">
           <div class="flex-container justify-center gap-4 mb-6 h-80">
               <div class="border border-gray-700 bg-black p-3 rounded-lg flex-container flex-col items-center w-1/3 shadow-lg">
                   <span class="text-xs font-bold text-yellow-500 mb-2 uppercase tracking-wide">Source Crop</span>
                   <img id="debug-img-source" class="h-full object-contain bg-[#1a1a1a] rounded border border-gray-800"/>
               </div>
               <div class="border border-gray-700 bg-black p-3 rounded-lg flex-container flex-col items-center w-1/3 shadow-lg">
                   <span class="text-xs font-bold text-purple-400 mb-2 uppercase tracking-wide">Blueprint (RLE)</span>
                   <div id="debug-blueprint" class="h-full w-full flex-container items-center justify-center bg-white text-black rounded border border-gray-800"></div>
               </div>
               <div class="border border-gray-700 bg-black p-3 rounded-lg flex-container flex-col items-center w-1/3 shadow-lg">
                   <span class="text-xs font-bold text-blue-400 mb-2 uppercase tracking-wide">SVG Result</span>
                   <div id="debug-svg-preview" class="h-full w-full flex-container items-center justify-center bg-white text-black rounded border border-gray-800"></div>
               </div>
           </div>
           <div class="flex-1 border border-gray-700 bg-gray-800 rounded-lg p-3 shadow-inner">
               <span class="text-xs font-bold text-gray-400 block mb-2 uppercase tracking-wide border-b border-gray-700 pb-1">Region Data (JSON)</span>
               <pre id="debug-log" class="text-xs font-mono text-green-400 overflow-auto h-full p-2"></pre>
           </div>
      </div>
    </main>

    <!-- Floating Action Bar for New Selections -->
    <div id="new-selection-action-bar" class="bg-gray-800 bg-opacity-95 text-white rounded-lg shadow-xl flex-container items-center p-1-5 gap-2 border border-gray-600 ring-1 ring-black\/50 backdrop-blur-sm">
      <span class="text-[10px] font-bold text-gray-400 px-2 uppercase tracking-wider">Create:</span>
      <!-- These call global methods initialized in src/main.js -->
      <button class="action-bar-btn bg-blue-600" onclick="app.createRegion('text')">Text</button>
      <button class="action-bar-btn bg-amber-600" onclick="app.createRegion('image')">Image</button>
      <button class="action-bar-btn bg-gray-600" onclick="app.createRegion('empty')">Empty</button>
      <div class="w-px h-4 bg-gray-600 mx-1"></div>
      <button class="px-2 py-1 text-gray-400 text-xs font-medium transition" onclick="app.clearSelection()">Cancel</button>
    </div>
    
    <!-- Hidden Canvas for high-resolution processing -->
    <canvas id="processing-canvas" style="display:none;"></canvas>
</body>
</html>
