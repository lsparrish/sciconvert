<!-- 
    This file has been simplified to use dedicated CSS classes for all structural elements,
    eliminating the need for utility classes in the HTML.
    -->
<style>
  /* --- Global Reset and Base Styles --- */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #111827;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    color: #1f2937;
    font-size: 14px;
    line-height: 1.5;
  }
  .hidden { display: none !important; }
  .relative { position: relative; }
  .absolute { position: absolute; }
  .inset-0 { top: 0; left: 0; right: 0; bottom: 0; }
  .transition { transition: all 0.15s ease-in-out; }
  .cursor-pointer { cursor: pointer; }

  /* --- Z-Indices --- */
  .z-10 { z-index: 10; }
  .z-20 { z-index: 20; }
  .z-30 { z-index: 30; }
  .z-50 { z-index: 50; }

  /* --- 1. Header Styles --- */
  .app-header-style {
    background-color: #1f2937;
    padding: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid #111827;
    flex-shrink: 0;
    z-index: 30;
  }
  .header-group-style { display: flex; align-items: center; gap: 1rem; }
  .header-h1 { font-size: 1.25rem; font-weight: 700; letter-spacing: 0.05em; color: #f3f4f6; margin-right: 1rem; }
  .header-h1 span { color: #60a5fa; }
  .header-divider { width: 1px; height: 1.5rem; background-color: #4b5563; margin-left: 0.5rem; margin-right: 0.5rem; }

  /* --- Header Component Styles --- */
  .zoom-controls-style {
    display: flex;
    align-items: center;
    background-color: #374151;
    border-radius: 0.375rem;
    padding: 0.125rem;
    box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
    border: 1px solid #4b5563;
  }
  .zoom-button { color: #d1d5db; padding: 0.25rem 0.5rem; border-radius: 0.125rem; font-weight: 700; }
  .zoom-button:hover { opacity: 0.8; }
  .zoom-level-text { font-size: 0.75rem; font-family: monospace; width: 3.5rem; text-align: center; color: #e5e7eb; user-select: none; }
  
  /* --- Primary Button Styles --- */
  .btn {
    padding: 0.375rem 0.75rem;
    border-radius: 0.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.15s ease-in-out;
  }
  .btn-primary { 
      background-color: #2563eb; 
      color: white; 
      border-color: rgba(96, 165, 250, 0.2); 
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  }
  .btn-primary:hover { background-color: #3b82f6; }
  .btn-secondary { 
      background-color: #374151;
      color: #e5e7eb;
      border-color: #4b5563;
  }
  .btn-secondary:hover { background-color: #4b5563; }

  /* --- 2. Main Layout and Workspace Styles --- */
  .main-wrapper-style {
    flex: 1 1 0%; 
    flex-direction: column; 
    overflow: hidden; 
    position: relative; 
    background-color: white;
    display: flex;
  }
  .workspace-style {
    flex: 1 1 0%;
    display: flex;
    overflow: hidden;
    position: relative;
  }

  /* --- Empty State/Loader Styles --- */
  .empty-state-style, .loader-style {
    position: absolute; 
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    z-index: 50; 
  }
  .empty-state-style { background-color: #f3f4f6; color: #374151; }
  .empty-card-style { background-color: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05); text-align: center; border: 1px solid #d1d5db; }
  .empty-card-style h2 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: #374151; }
  .empty-card-style p { font-size: 0.875rem; color: #374151; }
  
  .loader-style { background-color: rgba(17, 24, 39, 0.7); backdrop-filter: blur(4px); }
  .loader-spinner { width: 3rem; height: 3rem; border: 4px solid #4b5563; border-top-color: #3b82f6; border-radius: 9999px; animation: spin 1s linear infinite; margin-bottom: 1rem; }
  .loader-text { color: white; font-weight: 700; letter-spacing: 0.025em; font-size: 1.125rem; }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }


  /* --- 3. Editor Panel (Left) Styles --- */
  .editor-area-style {
      width: 400px; 
      min-width: 400px;
      height: 100%;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #d1d5db;
      background-color: white;
      z-index: 10;
      flex-shrink: 0;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  }
  .editor-header-style {
      background-color: #f3f4f6;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 700;
      color: #6b7280;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
  }
  .editor-header-actions { display: flex; gap: 0.5rem; align-items: center; }
  .editor-textarea { 
    font-family: monospace; 
    line-height: 1.5; 
    resize: none; 
    font-size: 11px; 
    width: 100%;
    height: 100%;
    padding: 0.5rem;
    border: none;
    outline: none;
    background-color: #f9fafb;
    color: #374151;
    flex: 1 1 0%;
  }

  /* --- Context Action Bar (Editor Footer) --- */
  .context-actions-style {
      padding: 0.375rem 0.75rem;
      border-top: 1px solid #d1d5db;
      background-color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      transition: opacity 0.15s;
  }
  .context-status-text { font-size: 0.75rem; font-weight: 700; color: #374151; }
  .context-button-group { display: flex; gap: 0.5rem; }

  /* --- 4. Canvas Viewport (Right) Styles --- */
  .canvas-view-style {
    flex: 1 1 0%; 
    height: 100%; 
    display: flex; 
    flex-direction: column; 
    background-color: #e5e7eb; 
    overflow: hidden; 
    position: relative;
  }
  .view-toggles-style {
      background-color: white; 
      padding: 0.5rem 1rem; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 1.5rem; 
      font-size: 0.75rem; 
      font-weight: 700; 
      color: #374151; 
      border-bottom: 1px solid #d1d5db; 
      flex-shrink: 0;
      z-index: 20;
  }
  .view-toggle-item { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
  .view-toggle-divider { width: 1px; height: 1rem; background-color: #d1d5db; }

  /* --- Canvas Scroller & Wrapper --- */
  .canvas-scroller-style {
    flex: 1 1 0%;
    overflow: auto; 
    display: flex; 
    justify-content: center; 
    padding: 3rem; 
    position: relative; 
    cursor: default; 
    background-color: #e5e7eb;
  }
  .canvas-wrapper-style {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
    transition: width 0.15s ease-out;
    background-color: white;
    position: relative;
    transform-origin: top;
    border: 1px solid rgba(17, 24, 39, 0.05);
  }
  
  /* --- SVG Interaction Styles --- */
  .region-highlight { stroke: #f97316; stroke-width: 2; fill: rgba(249, 115, 22, 0.05); opacity: 0; transition: opacity 0.15s; pointer-events: all; }
  .region-highlight:hover { opacity: 1.0; cursor: pointer; }
  .region-selected { stroke: #3b82f6; stroke-width: 2; fill: rgba(59, 130, 246, 0.2); pointer-events: all; cursor: move; }
  .region-draft { fill: rgba(59, 130, 246, 0.1); stroke: #3b82f6; stroke-width: 2; stroke-dasharray: 8, 4; animation: dash 30s linear infinite; pointer-events: none; }
  @keyframes dash { to { stroke-dashoffset: -1000; } }
  #selection-box { border: 2px dashed #3b82f6; background-color: rgba(59, 130, 246, 0.1); position: absolute; pointer-events: none; display: none; z-index: 50; }

  /* --- 5. Floating Action Bar Styles --- */
  .action-bar-style {
    position: fixed; 
    z-index: 100; 
    display: flex; 
    align-items: center; 
    background-color: rgba(31, 41, 55, 0.95);
    color: white;
    border-radius: 0.5rem;
    padding: 0.375rem 0.75rem;
    gap: 0.5rem;
    border: 1px solid #4b5563;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    
    /* Animation definition for the bar (still using utility names for simplicity here) */
    animation: fadeIn 0.1s ease-out;
  }
  .action-bar-style.hidden { display: none; }
  .action-bar-text { font-size: 0.75rem; font-weight: 700; color: #9ca3af; padding-left: 0.5rem; padding-right: 0.5rem; letter-spacing: 0.05em; }
  .action-bar-btn {
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    font-weight: 700;
    font-size: 0.75rem;
    color: white;
    transition: background-color 0.15s;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    border: 1px solid transparent;
  }
  .action-bar-btn:hover { opacity: 0.9; }
</style>

<!-- This is the structural HTML that will be injected into main.html's body -->
<div id="template-structure">
    <!-- HEADER -->
    <header class="app-header-style">
      <div class="header-group-style">
        <h1 class="header-h1">SciText <span>Digitizer</span></h1>
        
        <!-- File Upload -->
        <div class="relative">
          <input type="file" id="pdf-upload" accept="application/pdf, image/*" class="hidden" />
          <label for="pdf-upload" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:1rem; height:1rem;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
            Load
          </label>
        </div>
        
        <div class="header-divider"></div>

        <!-- Zoom Controls -->
        <div id="pdf-zoom-controls" class="zoom-controls-style">
          <button id="zoom-out" class="zoom-button">-</button>
          <span id="zoom-level" class="zoom-level-text">100%</span>
          <button id="zoom-in" class="zoom-button">+</button>
        </div>
      </div>
      
      <div class="header-group-style">
          <span id="ai-status" class="hidden text-blue-400" style="font-size:0.75rem; font-family:monospace;">Processing...</span>
          <button id="fullscreen-toggle" class="btn btn-secondary" style="font-size:0.75rem; font-weight:600;">Full Screen</button>
      </div>
    </header>

    <main class="main-wrapper-style">
      <!-- Empty State & Loader -->
      <div id="empty-state" class="empty-state-style">
        <div class="empty-card-style">
            <h2 style="font-weight:700;">No Document Loaded</h2>
            <p>Upload a PDF or Image to begin.</p>
        </div>
      </div>
      
      <div id="pdf-loader" class="loader-style hidden">
          <div class="loader-spinner"></div>
          <span class="loader-text">Loading...</span>
      </div>

      <!-- Main Workspace (Compositor/Overlay) -->
      <div id="workspace-container" class="workspace-style hidden">
          
          <!-- Left: Editor (Output + Actions) -->
          <div id="editor-output-area" class="editor-area-style">
              <div class="editor-header-style">
                  <span id="editor-title">COMPOSITE SVG OUTPUT</span>
                  <div class="editor-header-actions">
                     <button id="btn-export" class="btn btn-primary" style="font-size:0.75rem; font-weight:700;">Export SVG</button>
                     <button id="btn-clear-all" class="text-red-500" style="font-size:0.75rem; font-weight:500;">Reset Patches</button>
                  </div>
              </div>
              <textarea
                id="overlay-html-input"
                class="editor-textarea"
                placeholder="<!-- Composite SVG content will appear here after patching -->"
                readonly
              ></textarea>
              
              <!-- Simple Context Actions for Selected Patch -->
              <div id="context-actions" class="context-actions-style disabled">
                  <span id="active-patch-display" class="context-status-text">No Patch Selected</span>
                  <div class="context-button-group">
                       <button id="btn-regen" class="action-bar-btn bg-blue-600">Regen. Text</button>
                       <button id="btn-delete" class="btn btn-secondary text-red-500" style="font-size:0.75rem; font-weight:600;">Delete</button>
                  </div>
              </div>
          </div>

          <!-- Right Canvas Viewport -->
          <div id="canvas-view-area" class="canvas-view-style">
              <!-- View Toggles (Simplified) -->
              <div class="view-toggles-style">
                   <label class="view-toggle-item"><input type="checkbox" id="chk-source" checked style="color:#2563eb;"/><span>Source</span></label>
                   <div class="view-toggle-divider"></div>
                   <label class="view-toggle-item"><input type="checkbox" id="chk-svg" checked style="color:#2563eb;"/><span>SVG Overlay</span></label>
              </div>
              
              <!-- Canvas Scroller and Wrapper -->
              <div id="canvas-scroller" class="canvas-scroller-style">
                  <div id="canvas-wrapper" class="canvas-wrapper-style">
                      <!-- Layers rendered by JS: PDF Image, Grid, SVG Output, Interaction Area -->
                      <div id="pdf-layer" class="transition"></div> 
                      <!-- Grid layer and SVG layer remain. Note: main.js still handles grid toggle if needed -->
                      <div id="grid-layer" class="absolute inset-0 z-0" style="opacity:0.5; pointer-events:none;"></div>
                      <div id="svg-layer" class="absolute inset-0 z-10" style="pointer-events:none;"></div> 
                      <div id="interaction-layer" class="absolute inset-0 z-20"></div>
                      <div id="selection-box"></div>
                  </div>
              </div>
          </div>
      </div>
      
    </main>

    <!-- Floating Action Bar for New Selections -->
    <div id="new-selection-action-bar" class="action-bar-style">
      <span class="action-bar-text">CREATE:</span>
      <!-- These call global methods initialized in src/main.js -->
      <button class="action-bar-btn" style="background-color:#2563eb;" onclick="app.createRegion('text')">Text</button>
      <button class="action-bar-btn" style="background-color:#d97706;" onclick="app.createRegion('image')">Image</button>
      <button class="action-bar-btn" style="background-color:#4b5563;" onclick="app.createRegion('empty')">Empty</button>
      <div class="header-divider h-6"></div>
      <button class="action-bar-btn" style="color:#9ca3af; background-color:transparent;" onclick="app.clearSelection()">Cancel</button>
    </div>
    
    <!-- Hidden Canvas for high-resolution processing -->
    <canvas id="processing-canvas" style="display:none;"></canvas>
</div>
